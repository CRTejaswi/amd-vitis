%
% Copyright (C) 2023, Advanced Micro Devices, Inc. All rights reserved.
% SPDX-License-Identifier: MIT
%
% Author: Mark Rollins

function [wfta_o] = wfta( wfta_i )

   N = numel(wfta_i);
   switch N
    case  2, wfta_o = wfta2(wfta_i);
    case  3, wfta_o = wfta3(wfta_i);
    case  4, wfta_o = wfta4(wfta_i);
    case  5, wfta_o = wfta5(wfta_i);
    case  7, wfta_o = wfta7(wfta_i);
    case  9, wfta_o = wfta9(wfta_i);
    case 11, wfta_o = wfta11(wfta_i);
   end
end

% ------------------------------------------------------------
% Size 2
% ------------------------------------------------------------

function [wfta_o] = wfta2(wfta_i)
    A = [1,1;0,1];
    D = diag([1,-2]);
    wfta_o = A' * D * A * reshape(wfta_i,[],1);
end

% ------------------------------------------------------------
% Size 3
% ------------------------------------------------------------

function [wfta_o] = wfta3(wfta_i)
    A = [1,1,1;0,1,1;0,1,-1];
    D = diag([1,-1.50000000,-1i*0.86602540]);
    wfta_o = A' * D * A * reshape(wfta_i,[],1);
end

% ------------------------------------------------------------
% Size 4
% ------------------------------------------------------------

function [wfta_o] = wfta4(wfta_i)
    % Cannot figure this one out:
% $$$     A = [1,1,1,1;1,0,-1,0;1,-1,1,-1;0,1,0,1];
% $$$     D = diag([1,1,1,-1i]);
% $$$     wfta_o = A' * D * A * reshape(wfta_i,[],1);
    % Use matrix multiply instead:
    A = [1,1,1,1;1,-1i,-1,1i;1,-1,1,-1;1,1i,-1,-1i];
    wfta_o = A * reshape(wfta_i,[],1);
end

% ------------------------------------------------------------
% Size 5
% ------------------------------------------------------------

function [wfta_o] = wfta5(wfta_i)
    c = [0.95105652,-1.53884180,-0.36327126,0.55901699,-1.25];
    R1 = [1,1+c(5)+c(4),1+c(5)-c(4),1+c(5)-c(4),1+c(5)+c(4)];
    R2 = [0,c(1),c(1)+c(3),-c(1)-c(3),-c(1)];
    R3 = [1,1+c(5)-c(4),1+c(5)+c(4),1+c(5)+c(4),1+c(5)-c(4)];
    R4 = [0,c(2)+c(1),c(1),-c(1),-c(2)-c(1)];
    A = [1,1,1,1,1;...
         R1-1i*R2;...
         R3+1i*R4;...
         R3-1i*R4;...
         R1+1i*R2];
    wfta_o = A * reshape(wfta_i,[],1);
end

% ------------------------------------------------------------
% Size 7
% ------------------------------------------------------------

function [wfta_o] = wfta7(wfta_i)
    c = [-1.16666667,-0.79015647,0.055854267,0.7343022,0.44095855,-0.34087293,0.53396936,0.87484229,0.70710678];
    R1 = [1,1+c(1)+c(2)+c(4),1+c(1)-c(4),1+c(1)-c(2),1+c(1)-c(2),1+c(1)-c(4),1+c(1)+c(2)+c(4)];
    R2 = [1,1+c(1)-c(4),1+c(1)+c(4)+c(3),1+c(1)-c(3),1+c(1)-c(3),1+c(1)+c(4)+c(3),1+c(1)-c(4)];
    R3 = [1,1+c(1)-c(2),1+c(1)-c(3),1+c(1)+c(2)+c(3),1+c(1)+c(2)+c(3),1+c(1)-c(3),1+c(1)-c(2)];
    R4 = [0,c(5)-c(6),c(5)+c(7),-c(5)-c(6)+c(7),c(5)+c(6)-c(7),-c(5)-c(7),-c(5)+c(6)];
    R5 = [0,c(5)-c(8),c(5)-c(7)+c(8),-c(5)-c(7),c(5)+c(7),-c(5)+c(7)-c(8),-c(5)+c(8)];
    R6 = [0,c(5)+c(6)+c(8),c(5)-c(8),-c(5)+c(6),c(5)-c(6),-c(5)+c(8),-c(5)-c(6)-c(8)];
    A = complex(zeros(7,7),zeros(7,7));
    A(1,:) = ones(1,7);
    A(2,:) = R3-1i*R4;
    A(3,:) = R1-1i*R6;
    A(4,:) = R2+1i*R5;
    A(5,:) = R2-1i*R5;
    A(6,:) = R1+1i*R6;
    A(7,:) = R3+1i*R4;
    wfta_o = A * reshape(wfta_i,[],1);
end

% ------------------------------------------------------------
% Size 9
% ------------------------------------------------------------

function [wfta_o] = wfta9(wfta_i)
    c = [-0.86602540,0.93969262,-0.17364818,0.76604444,-0.5,-0.34202014,-0.98480775,-0.64278761];
    T1 = [1,c(4),c(2)-c(4),c(5),-c(2),-c(2),c(5),c(2)-c(4),c(4)];
    T2 = [0,c(8),c(6)+c(8),c(1),c(6),-c(6),-c(1),-c(6)-c(8),-c(8)];
    T3 = [1,-c(3),-c(2),c(5),c(2)+c(3),c(2)+c(3),c(5),-c(2),-c(3)];
    T4 = [0,-c(7),-c(6),c(1),-c(6)+c(7),+c(6)-c(7),-c(1),c(6),c(7)];
    T5 = [1,c(5),c(5),1,c(5),c(5),1,c(5),c(5)];
    T6 = [0,c(1),-c(1),0,c(1),-c(1),0,c(1),-c(1)];
    T7 = [1,c(3)-c(4),c(4),c(5),-c(3),-c(3),c(5),c(4),c(3)-c(4)];
    T8 = [0,c(7)-c(8),-c(8),c(1),-c(7),c(7),-c(1),c(8),-c(7)+c(8)];
    A = complex(zeros(9,9),zeros(9,9));
    A(1,:) = ones(1,9);
    A(2,:) = T1+1i*T2;
    A(9,:) = T1-1i*T2;
    A(3,:) = T3-1i*T4;
    A(8,:) = T3+1i*T4;
    A(4,:) = T5+1i*T6;
    A(7,:) = T5-1i*T6;
    A(5,:) = T7+1i*T8;
    A(6,:) = T7-1i*T8;
    wfta_o = A * reshape(wfta_i,[],1);
end

% ------------------------------------------------------------
% Size 11
% ------------------------------------------------------------

function [wfta_o] = wfta11(wfta_i)
    c = [1.10000000,0.33166250,0.51541500,0.94125350,1.41435370,0.85949300,...
         0.04231480,0.38639280,0.51254590,1.07027569,0.55486070,1.24129440,...
         0.20897830,0.37415717,0.04992992,0.65815896,0.63306543,1.08224607,...
         0.81720738,0.42408709];
    

end
